<div class="chat-window">

<!-- Seletor de inst√¢ncia -->
<div class="instance-select">
  <label for="instancia">Inst√¢ncia:</label>
  <select id="instancia" [(ngModel)]="instanciaSelecionada" (change)="trocaInstancia()">
    <option *ngFor="let inst of instancias" [value]="inst.name">
      {{ inst.name }} - ({{ inst.number }})
    </option>
  </select>
  <button (click)="adicionarInstancia()" class="add-instance-btn">‚ûï</button>
</div>


  <div class="header">
    Painel WhatsApp
  </div>

  <!-- Top Buttons -->
  <div class="top-buttons">
    <button routerLink="/config">‚öôÔ∏è Config</button>
    <button (click)="prepararCampanhateste()">üì¢ Campanha</button>
    <button routerLink="/contatos">üë• Contatos</button>
    <button (click)="prepararContato()">‚ûï Contato</button>
  </div>

  <!-- Lista de conversas -->
  <div *ngIf="conversations.length > 0" class="conversations-list">
    <h2>Conversas</h2>
    <ul>
      <li *ngFor="let convo of conversations" (click)="openConversation(convo)" class="conversation-item">
        {{ convo.nome }} ({{ convo.messages?.length || 0 }})
      </li>
    </ul>
  </div>

  <!-- Mensagens -->
  <div *ngIf="selectedConversation" class="messages" #messagesContainer>
    <div *ngFor="let msg of selectedConversation.messages"
         [ngClass]="{'message-me': msg.isMe, 'message-them': !msg.isMe}">
      <div class="message-content">
        {{ msg.body }}
        <small>{{ msg.timestamp ? (msg.timestamp | date:'shortTime') : '' }}</small>
      </div>
    </div>
  </div>

  <!-- Caixa de mensagem -->
  <div class="composer-wrapper" *ngIf="selectedConversation">
    <form class="composer" (ngSubmit)="onSendMessage()">
      <input
        type="text"
        placeholder="Digite uma mensagem..."
        autocomplete="off"
        [(ngModel)]="newMessage"
        name="message"
      />
      <button type="submit" class="send">‚û§</button>
    </form>

    <app-msgeprontafilhos
      *ngIf="newMessage.startsWith('/')"
      [mensagens]="mensagensProntas"
      [filtro]="newMessage.slice(1)"
      (selecionar)="onSelecionar($event)">
    </app-msgeprontafilhos>
  </div>

</div> <!-- ‚Üê fecha aqui o .chat-window -->

<!-- Modal Adicionar Contato -->
<div *ngIf="mostraFormularioContato" class="modal show">
  <div class="modal-backdrop" (click)="mostraFormularioContato = false"></div>
  <div class="add-contact">
    <h3>Adicionar Contato</h3>
    <input [(ngModel)]="novoNome" placeholder="Nome" name="nome" />
    <input [(ngModel)]="novoNumero" placeholder="N√∫mero com DDD (ex: 61999999999)" name="numero" />
    <div class="modal-buttons">
      <button (click)="adicionarContato()">Salvar</button>
      <button (click)="mostraFormularioContato = false">Fechar</button>
    </div>
  </div>
</div>

<!-- Modal Campanha -->
<div class="modal" [class.show]="modalAberto">
  <div class="modal-backdrop" (click)="fecharModal()"></div>
  <div class="modal-content">
    <span class="close" (click)="fecharModal()">&times;</span>
    <h2>Definir mensagem, hor√°rio e contato</h2>
    <form (ngSubmit)="dispararCampanha()">

      <label for="mensagem">Mensagem:</label>
      <textarea id="mensagem" [(ngModel)]="mensagemcampanha" name="mensagem" required></textarea>

      <label for="horario">Hor√°rio:</label>
      <input type="datetime-local" id="horario" [(ngModel)]="horario" name="horario" required>

      <label>Adicionar n√∫mero:</label>
      <div class="add-number">
        <input type="text" [(ngModel)]="novoNumeroCampanha" name="novoNumeroCampanha" placeholder="Ex: 61999999999" />
        <button type="button" (click)="adicionarNumero()">Adicionar</button>
      </div>

      <label>Importar lista de contatos:</label>
      <input type="file" id="arquivoContatos" (change)="lerArquivoContatos($event)" accept=".csv,.txt" />

      <ul>
        <li *ngFor="let num of numerosCampanha; let i = index">
          {{ num }}
          <button type="button" (click)="removerNumero(i)">Remover</button>
        </li>
      </ul>

      <label>Imagem (opcional):</label>
      <input type="file" (change)="onImagemSelecionada($event)" accept="image/*">

      <button type="submit">Confirmar</button>
    </form>
  </div>
</div>
